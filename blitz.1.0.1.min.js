/* Blitz.js | version : 1.0.1 | author : Jade Zhang | license : MIT */
!function(a){"use strict";var b=openDatabase?openDatabase:undefined;blitz.WebSQLDB=blitz.WebSQLDB={$:{name:"myDB",version:"1.0",desc:"",size:1024,errorMsg:"Your browser is not assist WebStorage!Please use IE9+,chrome,ff,opera,safari!"},execute:function(){},init:function(c){if(b)throw new Error(this.$.errorMsg);this.$=a.extend(this.$,c);if(cachedDB[this.$.name]&&confirm("The DB you want to create is existed,do you want replace it?")){cachedDB[this.$.name]=this.createDB(this.$.name,this.$.version,this.$.size);return}cachedDB[this.$.name]=createDB(this.$.name,this.$.version,this.$.desc,this.$.size)},createDB:function(a,c,d,e){return b(a,c,d,e)},insert:function(a,b,c,d){},update:function(a,b,c,d){},del:function(a,b,c,d){},getDB:function(a){if(cachedDB[a])return cachedDB[a]},cachedDB:{}}}(_)(function(a){"use strict";var b=["article","aside","audio","canvas","command","datalist","details","embed","figcaption","figure","footer","header","hgroup","keygen","mark","meter","nav","output","progress","rp","rt","ruby","section","source","summary","time","video","wbr"],c=["date","email","search","range","url","color","number"],d=function(a,b){document.createElement(a).type=b||""};if(a){for(var e=b.length-1;e--;)a[b[e]]&&d(b[e]);for(var f=c.length-1;f--;)a.inputtypes[b[e]]&&d(b[e],type)}else if(/ie [6|7|8]/ig.test(navigator.userAgent)){for(var e=b.length-1;e--;)d(b[e]);for(var f=c.length-1;f--;)d(b[e],type)}})(Modernizr)(function(a){"use strict";var b="moz moz_ o webkit ms khtml".split(" "),c=("IndexedDB$"+b.join("IndexedDB$")+"IndexedDB").split("$"),d=null;for(var e=c.length-1;e--;)window[c[e]]&&(d=window[c[e]]);d||alert("Your browser is not consist indexDB!"),"webkitIndexedDB"in window&&(window.IDBTransaction=window.webkitIDBTransaction,window.IDBKeyRange=window.webkitIDBKeyRange,window.IDBCursor=window.webkitIDBCursor),blitz.indexDB={DB:{},option:{name:"Test",version:"3.0",description:"This is a test DB!",entity:[{objName:"t1",keyName:"id",keyIncrement:!0,indexCols:{email:!0},data:[{id:1,name:"jade",email:"zhangjin_2006@126.com"},{id:2,name:"jade",email:"zjhiphop@gmail.com"}]}],openSuccessCb:function(){a.log("openSuccessCb")},transSuccessCb:function(){a.log("transSuccessCb")},transAbortCb:function(){a.log("transAbortCb")},transTimeoutCb:function(){a.log("transTimeoutCb")},cursorSuccessCb:function(){a.log("cursorSuccessCb")},addDataSuccessCb:function(b){a.log(b),a.log("addDataSuccessCb")},putDataSuccessCb:function(){a.log("putDataSuccessCb")},deleteDataSuccessCb:function(){a.log("deleteDataSuccessCb")},getDataSuccessCb:function(b){a.log(b.target.result),a.log("getDataSuccessCb")}},_constant:{trans:{read_only:IDBTransaction.READ_ONLY,read_write:IDBTransaction.READ_WRITE,version_change:IDBTransaction.VERSION_CHANGE},cursor:{next:IDBCursor.NEXT,next_unique:IDBCursor.NEXT_NO_DUPLICATE,prev:IDBCursor.PREV,prev_unique:IDBCursor.PREV_NO_DUPLICATE}},_config:{DBReady:!1},init:function(b){a.augement(this.option,b);var c=this.option,e=d.open(this.option.name),f=this;e.onsuccess=function(){var b=c.name+c.version,d=f.DB[b]=e.result;f._config.DBReady=!0;if(d.version!==c.version){var g=d.setVersion(c.version);g.onsuccess=function(a){f._createObjectStore(d),c.openSuccessCb&&c.openSuccessCb()},g.onerror=function(b){a.log("req_version.onerror")}}else c.openSuccessCb&&c.openSuccessCb()},e.onerror=function(b){a.log("request.onerror")}},_createObjectStore:function(b){var c="";for(var d=this.option.entity.length;d--;){a.log(c),c=this.option.entity[d],b.objectStoreNames.contains(c.objName)&&b.deleteObjectStore(c.objName);var e=b.createObjectStore(c.objName,{keyPath:c.keyName,autoIncrement:c.keyIncrement});for(var d in c.indexCols)c.indexCols.hasOwnProperty(d)&&e.createIndex(d,d,{unique:c.indexCols[d]});for(var f=c.data.length;f--;)c.data.hasOwnProperty(f)&&e.add(c.data[f])}},getAll:function(a,b){var c=this._cursorFactory("normal",a,b);this._cursorHandler(c,this.option)},getAllByIndex:function(a,b,c,d){var e=this._cursorFactory("index",a,b,c,d);this._cursorHandler(e,this.option)},_cursorHandler:function(b,c){b.onsuccess=function(a){var b=a.target.result,d={};return Array.isArray(b)?d=b:b&&b.value&&(d=b.value,b["continue"]&&typeof b["continue"]=="function"&&b["continue"]()),c.cursorSuccessCb&&c.cursorSuccessCb(d),d},b.onerror=function(b){a.log(b)}},deleteAll:function(){confirm("Are you sure to delete all data now?")&&this._clear()},getCurrentDB:function(){var a=this.option,b=a.name+a.version;return this.DB[b]},trans:function(b,c,d,e,f){try{var g=this._constant.trans[c],h=this.getCurrentDB(),i=h.transaction([b],g,0);return i.oncomplete=d||this.option.transSuccessCb,i.oncomplete=e||this.option.transAbortCb,i.ontimeout=e||this.option.transTimeoutCb,i.objectStore(b)}catch(j){a.log(j)}},getCursor:function(a,b){var b=b||"read_only",c=IDBKeyRange.lowerBound(0),d=this.trans(a,b),e;return d.getAll?e=d.getAll():e=d.openCursor(c),e},getRangeCursorByIndex:function(a,b,c,d){var b=b||"read_only",e=this._constant.cursor,f=e[c]||e.next;if(d){var g=null;d.only&&(g=IDBKeyRange.only(d.begin,d.begin_include)),d.begin&&d.end?g=IDBKeyRange.bound(d.begin,d.begin_include,d.end,d.end_include):d.begin?g=IDBKeyRange.lowerBound(d.begin,d.begin_include):d.end&&(g=IDBKeyRange.upperBound(d.end,d.end_include))}var e=this.trans(a,b).openCursor(g,f);return e},_bindCb:function(b,c,d,e){b.onsuccess=c||function(c){a.log(b+" success")},b.onerror=d||function(b){a.log("Error: "+e+" operation fail")}},_requestFactory:function(a,b,c,d){var e=this.trans(b,d?"read_only":"read_write"),f=e[a](c);this._bindCb(f,this.option[a+"DataSuccessCb"],null,a)},_cursorFactory:function(a,b,c,d,e){switch(a){case"normal":return this.getCursor(b,c);case"index":return this.getRangeCursorByIndex(b,c,d,e);default:return this.getCursor(b,c)}},addData:function(a,b){this._requestFactory("add",a,b)},putData:function(a,b){this._requestFactory("put",a,b)},delData:function(a,b){this._requestFactory("delete",a,b)},getData:function(a,b){this._requestFactory("get",a,b,!0)},_clear:function(){this._requestFactory("clear",tableName)}}})(blitz.utility),!function(a){a.plugin=function(b,c){a.fn[b]=function(d){var e=[].prototype.slice.call(arguments,1);return this.each(function(){var f=a.data(this,b);f?f[d].apply(f,e):f=a.data(this,b,new c(d,this))})}};var b=!1,c=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;this.Class=function(){},Class.extend=function(a){function g(){!b&&this.init&&this.init.apply(this,arguments)}var d=this.prototype;b=!0;var e=new this;b=!1;for(var f in a)e[f]=typeof a[f]=="function"&&typeof d[f]=="function"&&c.test(a[f])?function(a,b){return function(){var c=this._super;this._super=d[a];var e=b.apply(this,arguments);return this._super=c,e}}(f,a[f]):a[f];return g.prototype=e,g.prototype.constructor=g,g.extend=arguments.callee,g}}(jQuery)(function(a){"use strict",blitz.localStorage=window.localStorage?window.localStorage:function(){var b={};throw new Error("Your browser is not consist localStorage")}()})(jQuery),blitz.mediator=function(){var a=function(a,b){return mediator.channels[a]||(mediator.channels[a]=[]),mediator.channels[a].push({context:this,callback:b}),this},b=function(a){if(!mediator.channels[a])return!1;var b=Array.prototype.slice.call(arguments,1);for(var c=0,d=mediator.channels[a].length;c<d;c++){var e=mediator.channels[a][c];e.callback.apply(e.context,b)}return this};return{channels:{},publish:b,subscribe:a,installTo:function(c){c.subscribe=a,c.publish=b}}}(),!function(a){"use strict",a.observer=function(a){var b={},c=function(a){if(b.hasOwnProperty(a))throw new Error('addEvent: Already an event named "'+a+'"');b[a]=[]},d=function(a,c){if(!b.hasOwnProperty(a))throw new Error('addObserver: No event "'+a+'".');var d=b[a];for(var e=0,f=d.length;e<f;e++)if(d[e]===c)throw new Error("Cannot add the same listener more than once.");d.push(c)},e=function(a,c){if(!b.hasOwnProperty(a))throw new Error('removeObserver: No event "'+a+'".');var d=b[a];for(var e=0,f=d.length;e<f;e++)if(d[e]===c){d.splice(e,1);return}throw new Error("removeObserver: Did not find the observer and so could not remove it.")},f=function(a,c){if(!b.hasOwnProperty(a))throw new Error('notifyObservers: No event "'+a+'".');var d=b[a];for(var e=0,f=d.length;e<f;e++)d[e](c)};for(var g=0,h=a.length;g<h;g++){var i=a[g];c(i)}return{addEvent:c,addObserver:d,removeObserver:e,notifyObservers:f}}}(blitz)(function(a,b){"use strict";var c=(navigator||window.navigator).userAgent;window.console||(window.firebug=document.createElement("script"),firebug.setAttribute("src","http://getfirebug.com/releases/lite/1.2/firebug-lite-compressed.js"),document.body.appendChild(firebug),function e(){window.firebug.version?firebug.init():setTimeout(e)}(),void firebug,firebug.onerror=function(){if(!window.console){var a=["log","debug","info","warn","error","assert","dir","dirxml","group","groupEnd","time","timeEnd","count","trace","profile","profileEnd"];window.console={};for(var b=0;b<a.length;++b)window.console[a[b]]=function(){}}});var d=d||{};d.clone=d.clone||function(a){if(Object.create)return Object.create(a);var b=function(){};return b.prototype=a,new b},d.utility={log:function(b){typeof b=="object"&&(this.config._result="",this.getAllObjProp(b),b=this.config._result,this._dispose()),console.log?console.log(b):window.status?window.status=b:a("title").text(a("title").text()+" log:"+b)},getAllObjProp:function(a){for(var b in a)if(a.hasOwnProperty(b))if(typeof a[b]=="object"){var c=this.config.deep++;while(c--)this.config._result+="  ";this.config._result+=b+"--\r\n",this.getAllObjProp(a[b]),this.config.deep--}else{var c=this.config.deep;while(c--)this.config._result+="  ";this.config._result+=b+"-"+a[b]+"\r\n"}},augement:function(a,b){if(arguments.length<2)return a;if(!a||!b||typeof a!="object"&&typeof b!="object")return a;var c=d.clone(b);for(var e in c)a[e]=c[e]},createStyleElemnt:function(a){if(document.all)window.style=a,document.createStyleSheet("javascript:style");else{var b=document.createElement("style");b.type="text/css",b.rel="stylesheet",b.innerHTML=a,document.getElementsByTagName("HEAD")[0].appendChild(b)}},config:{_result:"",_inObj:!1,deep:0},_dispose:function(){this.config={_result:"",_inObj:!1,deep:0}},isIE:0,isIE6:/ie 6/ig.test(c),isIE7:/ie 7/ig.test(c),isIE8:/ie 8/ig.test(c),isIE9:/ie 9/ig.test(c),isIpad:/ipad/ig.test(c),isChrome:/chrome/ig.test(c),isFirefox:/firefox/ig.test(c),isOpera:/opera/ig.test(c),isSafari:c.indexOf("Safari")>-1&&c.indexOf("Chrome")<1,cssCheck:function(a){var c=document.createElement("cssText").style,d="Webkit Moz O ms Khtml".split(" "),e=a.charAt(0).toUpperCase()+a.substr(1),f=(a+" "+d.join(e+" ")+e).split(" ");for(var g in f)if(c[f[g]]!==b)return!0;return!1},flashChecker:function(){var a=0,b=0,c=0;if(c){var d=new ActiveXObject("ShockWaveFlash.ShockWaveFlash");d&&(a=1,VSwf=d.GetVariable("$version"),b=parseInt(VSwf.split(" ")[1].split(",")[0],10))}else if(navigator.plugins&&navigator.plugins.length>0){var d=navigator.plugins["Shockwave Flash"];if(d){a=1;var e=d.description.split(" ");for(var f=0;f<e.length;f++){if(isNaN(e[f]))continue;b=parseInt(e[f],10)}}}return{hasInstall:a||swfobject.hasFlashPlayerVersion("10"),version:b||swfobject.getFlashPlayerVersion().major}},process:function(a,b){var c=null;return function(){var d=arguments,e=this;clearTimeout(c),c=setTimeout(function(){a.apply(e,d)},b)}},getScrollY:function(){return window.pageYOffset||document.documentElement&&document.documentElement.scrollTop||document.body&&document.body.scrollTop},getScrollX:function(){return window.pageXOffset||document.documentElement&&document.documentElement.scrollLeft||document.body&&document.body.scrollLeft},profile:function(a){var b=[].slice.call(arguments,0),c=this;return console&&typeof a=="function"?function(){console.profile(),a.apply(c,b),console.profileEnd()}:function(){var e=+(new Date);a.apply(c,b);var f=+(new Date);d.utility.log("total time:"+f-e)}},purge:function(a){if(typeof a!="object"){this._purge(a);return}var b=a.length;if(b===0)return;var c;for(c=0;c<b;c+=1)this._purge(a[c])},_purge:function(a){if(!a)return;var b=a.attributes,c,d,e;if(b){d=b.length;for(c=0;c<d;c+=1)e=b[c].name,typeof a[e]=="function"&&(a[e]=null)}b=a.childNodes;if(b){d=b.length;for(c=0;c<d;c+=1)this._purge(a.childNodes[c])}},loadTemplate:function(b,c,d,e,f){this.purge(b.children()),a.ajaxSetup({cache:!0}),/ie 6/i.test(navigator.userAgent)&&document.execCommand("BackgroundImageCache",!1,!0),b.setTemplateURL(c+"?siteversion="+window.siteVersion,e,f),b.processTemplate(d)},loadTemplateToText:function(b,c,d,e,f){var g="";a.ajaxSetup({cache:!0}),/ie 6/i.test(navigator.userAgent)&&document.execCommand("BackgroundImageCache",!1,!0);var h;return h=a.createTemplateURL(b+"?siteversion="+window.siteVersion,e,f),g=a.processTemplateToText(h,c,d),g},getUrlValue:function(a){var a=a!==b?a:window.location.href;if(a.indexOf("#")>-1&&a.indexOf("?")>-1)var c=a.replace(/#/i,"&").split("?")[1];else var c=a.split("?")[1];if(c==""||typeof c=="undefined")return{};var d={};c=c.split("&");for(var e=0,f=c.length;e<f;e++)d[c[e].split("=")[0]]=c[e].split("=")[1];return d},setUrlValue:function(a,b){var c=a||window.location.href,d;if(c.indexOf("#")>-1){var d=c.split("#")[1];c=c.split("#")[0]}c.indexOf("?")<0&&(c+="?");var e=getUrlValue(c);for(var f in b)e[f]=b[f];c=c.split("?")[0]+"?";for(var f in e)c+=f+"="+e[f]+"&";return c=c.substr(0,c.length-1),c},proxy:function(a,b){var c=a||this;return function(){return b.apply(a,arguments)}},memoize:function(a){"use strict";var b=a.memoize=a.memoize||{},c=JSON.stringify,d=Array.prototype.slice;return function(){var e=c(d.call(arguments));return e in b?b[e]:b[e]=a.apply(this,arguments)}}},a.util$=d.utility})(jQuery)