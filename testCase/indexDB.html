<!DOCTYPE HTML>
<html lang="en-US">
    <head>
        <meta charset="UTF-8">
        <title>To Do with indexDB</title>
        <style type="text/css">
            body {
                font-size: 20px;
            }
            
            #container {
                margin: 0 auto;
                background: #DDD;
                border-radius: 10px;
                padding: 10px;
                width: 50%;
            }
            
            li {
                font-weight: bolder;
            }
        </style>
    </head>
    <body>
        <div id='container'>
            <input id='todo_input' type="text" /><input onclick="addTodo()" type="button" value='[add todo]'/>
            <p>
                TO DO List:
            </p>
            <ul id="todoItems">
            </ul>
        </div>
        <script type="text/javascript" src='../blitz.loader.js'>
        </script>
        <script type="text/javascript">
            
            blitz.Loader.loadScripts(['../Lib/jquery-latest.js', '../OOJS/blitz.clone.js', '../Tools/expandNative.js','../Tools/blitz.utility.js', '../Tools/blitz.indexDB.js'], function(){
                var option = {
                    name: 'Todo',
                    version: '1.0.0',
                    description: 'This is a todo DB!',
                    entity: [{
                        objName: 'todo',
                        keyName: 'times',
                        keyIncrement: true,
                        indexCols: {
                            text: false
                        },
                        data: [{
                            text: 'play basketball',
                            times: +new Date
                        }, {
                            text: 'have lunch',
                            times: +new Date
                        }]//used to create storeObject
                    }],
                    openSuccessCb: function(){
                        blitz.indexDB.getAll('todo');
                    },
                    cursorSuccessCb: function(result){
                        renderTodo(result);
                    },
                    deleteDataSuccessCb: function(result){
                        renderTodo(result);
                        location.reload();
                    },
                    addDataSuccessCb: function(result){
                        renderTodo(result);
                        location.reload();
                    }
                };
                blitz.indexDB.init(option);
                
            }, true);
            function renderTodo(result){
                if (result.text) {
                    var todos = document.getElementById("todoItems");
                    var li = document.createElement("li");
                    var a = document.createElement("a");
                    a.style.cursor = 'pointer';
                    var t = document.createTextNode();
                    t.data = result.text;
                    
                    a.addEventListener("click", function(e){
                        blitz.indexDB.delData('todo', result.times);
                    });
                    
                    a.textContent = "   [Delete]";
                    li.appendChild(t);
                    li.appendChild(a);
                    todos.appendChild(li);
                }
            }
            
            function addTodo(){
                var text = document.getElementById('todo_input').value;
                blitz.indexDB.addData('todo', {
                    text: text,
                    times: +new Date
                });
            }
        </script>
    </body>
</html>
